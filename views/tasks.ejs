<%- include('partials/header', { title: 'Your Tasks' }) %>

<section class="card">
  <div class="tasks-header">
    <h1>Your tasks</h1>
    <a href="/tasks/add" class="btn btn-primary">+ Add task</a>
  </div>

  <% if (tasks && tasks.length > 0) { %>
    <div class="tasks-table-wrapper">
      <table class="tasks-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Due date</th>
            <th>Status</th>
            <th style="width: 1%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% tasks.forEach(task => { %>
            <tr>
              <td>
                <span class="task-title"><%= task.title %></span>
              </td>
              <td><%= task.description || '-' %></td>
              <td>
                <%= task.dueDate ? task.dueDate.toISOString().slice(0, 10) : '-' %>
              </td>
              <td>
                <span class="task-status-pill <%= task.status === 'completed' ? 'completed' : 'pending' %>">
                  <%= task.status === 'completed' ? 'Completed' : 'Pending' %>
                </span>
              </td>
              <td>
                <div class="task-row-actions">
                  <a href="/tasks/edit/<%= task.id %>" class="btn btn-ghost btn-xs">Edit</a>

                  <form method="post" action="/tasks/status/<%= task.id %>">
                    <input type="hidden" name="status" value="<%= task.status === 'completed' ? 'pending' : 'completed' %>" />
                    <button type="submit" class="btn btn-ghost btn-xs">
                      <%= task.status === 'completed' ? 'Mark pending' : 'Mark done' %>
                    </button>
                  </form>

                  <form method="post" action="/tasks/delete/<%= task.id %>" onsubmit="return confirm('Delete this task?');">
                    <button type="submit" class="btn btn-danger btn-xs">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p class="tasks-empty">
      You don’t have any tasks yet. Click “Add task” to create your first one.
    </p>
  <% } %>
</section>

<%- include('partials/footer') %>
